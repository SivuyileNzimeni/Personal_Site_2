<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-GB" xml:lang="en-GB"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.280">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sivuyile Nzimeni">
<meta name="dcterms.date" content="2022-12-18">
<meta name="description" content="Analysing the 2022 Ask A Manager Salary Survey. In this post, we detail the data preprocessing procedure, feature-selection and modelling process to estimate salaries among respondents.">

<title>Sivuyile Nzimeni - 2022 Ask A Manager Salary Survey</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-listing/list.min.js"></script>
<script src="../../site_libs/quarto-listing/quarto-listing.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: [{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: [],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="twitter:title" content="Sivuyile Nzimeni - 2022 Ask A Manager Salary Survey">
<meta name="twitter:description" content="Analysing the 2022 Ask A Manager Salary Survey. In this post, we detail the data preprocessing procedure, feature-selection and modelling process to estimate salaries among respondents.">
<meta name="twitter:image" content="./Ask_A_Manager_2022.png">
<meta name="twitter:creator" content="@Sivu_Nzimeni">
<meta name="twitter:site" content="sivuyilenzimeni.netlify.app">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Sivuyile Nzimeni</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/Sivu_Nzimeni"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/SivuyileNzimeni"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://za.linkedin.com/in/sivuyile-nzimeni-98006ba0"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">CONTENTS</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">1</span>  INTRODUCTION</a>
  <ul class="collapse">
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing"><span class="toc-section-number">1.1</span>  DATA PREPROCESSING</a></li>
  </ul></li>
  <li><a href="#data-modelling" id="toc-data-modelling" class="nav-link" data-scroll-target="#data-modelling"><span class="toc-section-number">2</span>  DATA MODELLING</a>
  <ul class="collapse">
  <li><a href="#ols-model-swiss-knife-approach" id="toc-ols-model-swiss-knife-approach" class="nav-link" data-scroll-target="#ols-model-swiss-knife-approach"><span class="toc-section-number">2.1</span>  OLS MODEL: SWISS KNIFE APPROACH</a></li>
  <li><a href="#mars-model-splines-and-lines" id="toc-mars-model-splines-and-lines" class="nav-link" data-scroll-target="#mars-model-splines-and-lines"><span class="toc-section-number">2.2</span>  MARS MODEL: SPLINES AND LINES</a></li>
  <li><a href="#keras-gun-to-a-knife-fight" id="toc-keras-gun-to-a-knife-fight" class="nav-link" data-scroll-target="#keras-gun-to-a-knife-fight"><span class="toc-section-number">2.3</span>  KERAS: GUN TO A KNIFE FIGHT</a></li>
  </ul></li>
  <li><a href="#final-comparison" id="toc-final-comparison" class="nav-link" data-scroll-target="#final-comparison"><span class="toc-section-number">3</span>  FINAL COMPARISON</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">2022 Ask A Manager Salary Survey</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Data Modelling</div>
    <div class="quarto-category">Data Cleaning</div>
  </div>
  </div>

<div>
  <div class="description">
    Analysing the 2022 Ask A Manager Salary Survey. In this post, we detail the data preprocessing procedure, feature-selection and modelling process to estimate salaries among respondents.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sivuyile Nzimeni </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">18 December 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level1 page-columns page-full" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> INTRODUCTION</h1>
<p>Last year, we analysed the <a href="https://sivuyilenzimeni.netlify.app/posts/2021%20ask%20a%20manager%20salary%20survey/">2021 Ask A Manager Salary Survey</a>. The dataset is interesting for many reasons including,most beneficially, the dataset is open and available for all interested parties. It is also offers an opportunity to move beyond old and boring datasets such as <code>mtcars</code> and <code>iris</code>. The results of the survey offer an opportunity to clean open-text fields, currency data and feature engineering for data modelling.</p>
<p>Fortunately, there is a <a href="https://docs.google.com/spreadsheets/d/1Uq5GwatBdujitJkP2X5SDChHSbg68rmuOz9T9eTzu40/edit?resourcekey#gid=1660826355">2022 Ask A Manager Salary Survey</a> that is also freely available. Notably, there were only 15 465 respondents compared to 27 919 responds in the previous survey. It is difficult to estimate the reasons for the reduction in responses. Nonetheless,there are sufficient responses to model upon. The second batch of responses offers an opportunity to refine the data preprocessing and modelling process.</p>
<section id="data-preprocessing" class="level2 page-columns page-full" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="data-preprocessing"><span class="header-section-number">1.1</span> DATA PREPROCESSING</h2>
<p>Unlike in the previous post, the data preprocessing step is contained in a stand-alone script <code>./Scripts/2022_Data_Cleaner.R</code>. This helps with two main aspects; i) practising modular scripts and ii) reducing the size of the analysis. The data cleaning script has several components in it. The table below summarises the aforementioned components.</p>
<div class="cell" data-layout-align="center">
<details>
<summary>see code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(gtExtras)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">data.frame</span>(<span class="at">section =</span> <span class="fu">c</span>(<span class="st">"Importing Libraries"</span>,<span class="st">"Importing Data"</span>,<span class="st">"Open Text Cleaning"</span>,</span>
<span id="cb1-5"><a href="#cb1-5"></a>                       <span class="st">"List to Vec"</span>,<span class="st">"Completeness Check"</span>),</span>
<span id="cb1-6"><a href="#cb1-6"></a>           <span class="at">script_sample =</span><span class="fu">c</span>(<span class="st">'lapply(as.list(c("tidyverse","janitor","arrow",</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="st">                 "ggthemes","tidytext","tidymodels",</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="st">                 "textrecipes","glmnet")),</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="st">       require,character.only=TRUE) |&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="st">  suppressWarnings() |&gt; </span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="st">  suppressMessages() |&gt; </span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="st">  invisible()'</span>,<span class="st">'read_csv(file = "./Data/Ask A Manager Salary Survey 2022_Responses.csv") |&gt; </span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="st">  clean_names() |&gt; </span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="st">  mutate(timestamp = mdy_hms(timestamp)) |&gt; </span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="st">  filter(!is.na(job_title)) |&gt; </span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="st">  mutate(additional_compensation = ifelse(is.na(additional_compensation),</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="st">                                          0,additional_compensation),</span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="st">         full_compensation = salary+additional_compensation) |&gt; </span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="st">  filter(!currency %in% c("Other","HKD")) |&gt; </span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="st">  rownames_to_column("respondent")'</span>,<span class="st">'text_cleaner &lt;- function(a_vec){</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="st">  tokens &lt;- str_split(a_vec,pattern="</span><span class="sc">\\</span><span class="st">s{1,}") |&gt; </span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="st">    unlist()</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="st">  tokens &lt;- tokens[!grepl("</span><span class="sc">\\</span><span class="st">s{1,}|[[:punct:]]|</span><span class="sc">\\</span><span class="st">d{1,}",tokens)] |&gt; str_to_lower()</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="st">  tokens &lt;- unique(tokens) </span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="st">  tokens &lt;- tokens[!tokens %in% c(stopwords::data_stopwords_nltk[["en"]])]</span></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="st">  return(tokens)}'</span>,<span class="st">'list_to_vec &lt;- function(a_vec){</span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="st">  new_vec &lt;- a_vec |&gt; </span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="st">    as.character()</span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="st">new_vec &lt;- gsub("(^c+[[:punct:]])|[[:punct:]]",</span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="st">                replacement = "",</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="st">                new_vec)</span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="st">  return(new_vec)}</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="st">'</span>,<span class="st">'completeness &lt;- function(a_vec){</span></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="st">  incomplete &lt;- round(100/length(a_vec)*a_vec[is.na(a_vec)] |&gt; length(),2)</span></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="st">return(incomplete)}</span></span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="st">'</span>),</span>
<span id="cb1-37"><a href="#cb1-37"></a>           <span class="at">reasoning =</span> <span class="fu">c</span>(<span class="st">"importing libraries required for preprocessing"</span>,</span>
<span id="cb1-38"><a href="#cb1-38"></a>                         <span class="st">"import data, convert date column to date type, remove unviable cases and create total compensation columns"</span>,</span>
<span id="cb1-39"><a href="#cb1-39"></a>                         <span class="st">"split open-text fields into tokens, remove punctuation, spaces and stopwords. The function returns a list of words per case"</span>,</span>
<span id="cb1-40"><a href="#cb1-40"></a>                         <span class="st">"Convert the list of words per case to a vector."</span>,</span>
<span id="cb1-41"><a href="#cb1-41"></a>                         <span class="st">"Check the level of missing values in each column."</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb1-42"><a href="#cb1-42"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span> </span>
<span id="cb1-43"><a href="#cb1-43"></a>  <span class="fu">gt_theme_nytimes</span>() <span class="sc">|&gt;</span> </span>
<span id="cb1-44"><a href="#cb1-44"></a>  <span class="fu">tab_header</span>(<span class="at">title =</span> <span class="st">"2022 Data Clean Script Overview"</span>,</span>
<span id="cb1-45"><a href="#cb1-45"></a>                 <span class="at">subtitle =</span> <span class="st">"An overview of sections in the data cleaning script"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-46"><a href="#cb1-46"></a>  <span class="fu">opt_align_table_header</span>(<span class="at">align =</span> <span class="st">"center"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb1-47"><a href="#cb1-47"></a>  <span class="fu">tab_style</span>(<span class="at">style =</span> <span class="fu">list</span>(</span>
<span id="cb1-48"><a href="#cb1-48"></a>    <span class="fu">cell_fill</span>(<span class="at">color=</span> <span class="st">"#490E6F"</span>,<span class="at">alpha=</span><span class="fl">0.8</span>),</span>
<span id="cb1-49"><a href="#cb1-49"></a>    <span class="fu">cell_text</span>(<span class="at">color =</span> <span class="st">"white"</span>,<span class="at">font=</span><span class="fu">google_font</span>(<span class="st">"Fira Code"</span>),</span>
<span id="cb1-50"><a href="#cb1-50"></a>              <span class="at">align =</span> <span class="st">"center"</span>,<span class="at">style =</span> <span class="st">"normal"</span>,</span>
<span id="cb1-51"><a href="#cb1-51"></a>              <span class="at">weight=</span> <span class="st">"lighter"</span>,<span class="at">whitespace =</span> <span class="st">"pre-line"</span>)</span>
<span id="cb1-52"><a href="#cb1-52"></a>  ),</span>
<span id="cb1-53"><a href="#cb1-53"></a>  <span class="at">locations=</span> <span class="fu">cells_body</span>(</span>
<span id="cb1-54"><a href="#cb1-54"></a>    <span class="at">columns =</span> script_sample</span>
<span id="cb1-55"><a href="#cb1-55"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="pzjcuyulbw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>@import url("https://fonts.googleapis.com/css2?family=Fira+Code:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Libre+Franklin:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap");
html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#pzjcuyulbw) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#pzjcuyulbw) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#pzjcuyulbw) .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

:where(#pzjcuyulbw) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#pzjcuyulbw) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#pzjcuyulbw) .gt_bottom_border {
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#pzjcuyulbw) .gt_col_headings {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: none;
  border-bottom-width: 1px;
  border-bottom-color: #334422;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#pzjcuyulbw) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 12px;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#pzjcuyulbw) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 12px;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#pzjcuyulbw) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#pzjcuyulbw) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#pzjcuyulbw) .gt_column_spanner {
  border-bottom-style: none;
  border-bottom-width: 1px;
  border-bottom-color: #334422;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#pzjcuyulbw) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#pzjcuyulbw) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#pzjcuyulbw) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#pzjcuyulbw) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#pzjcuyulbw) .gt_row {
  padding-top: 7px;
  padding-bottom: 7px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#pzjcuyulbw) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#pzjcuyulbw) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#pzjcuyulbw) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#pzjcuyulbw) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#pzjcuyulbw) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#pzjcuyulbw) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#pzjcuyulbw) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#pzjcuyulbw) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#pzjcuyulbw) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#pzjcuyulbw) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#pzjcuyulbw) .gt_table_body {
  border-top-style: none;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #FFFFFF;
}

:where(#pzjcuyulbw) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#pzjcuyulbw) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#pzjcuyulbw) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#pzjcuyulbw) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#pzjcuyulbw) .gt_left {
  text-align: left;
}

:where(#pzjcuyulbw) .gt_center {
  text-align: center;
}

:where(#pzjcuyulbw) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#pzjcuyulbw) .gt_font_normal {
  font-weight: normal;
}

:where(#pzjcuyulbw) .gt_font_bold {
  font-weight: bold;
}

:where(#pzjcuyulbw) .gt_font_italic {
  font-style: italic;
}

:where(#pzjcuyulbw) .gt_super {
  font-size: 65%;
}

:where(#pzjcuyulbw) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#pzjcuyulbw) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#pzjcuyulbw) .gt_indent_1 {
  text-indent: 5px;
}

:where(#pzjcuyulbw) .gt_indent_2 {
  text-indent: 10px;
}

:where(#pzjcuyulbw) .gt_indent_3 {
  text-indent: 15px;
}

:where(#pzjcuyulbw) .gt_indent_4 {
  text-indent: 20px;
}

:where(#pzjcuyulbw) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  <thead class="gt_header">
    <tr>
      <td colspan="3" class="gt_heading gt_title gt_font_normal" style="font-family: 'Libre Franklin'; font-weight: 800;">2022 Data Clean Script Overview</td>
    </tr>
    <tr>
      <td colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border" style="">An overview of sections in the data cleaning script</td>
    </tr>
  </thead>
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="color: #A9A9A9; font-family: 'Source Sans Pro'; text-transform: uppercase;" scope="col" id="section">section</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="color: #A9A9A9; font-family: 'Source Sans Pro'; text-transform: uppercase;" scope="col" id="script_sample">script_sample</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" style="color: #A9A9A9; font-family: 'Source Sans Pro'; text-transform: uppercase;" scope="col" id="reasoning">reasoning</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="section" class="gt_row gt_left" style="font-family: 'Source Sans Pro'; font-weight: 400;">Importing Libraries</td>
<td headers="script_sample" class="gt_row gt_left" style="font-family: 'Fira Code'; font-weight: lighter; color: #FFFFFF; text-align: center; font-style: normal; white-space: pre-line; background-color: rgba(73,14,111,0.8);">lapply(as.list(c("tidyverse","janitor","arrow",
                 "ggthemes","tidytext","tidymodels",
                 "textrecipes","glmnet")),
       require,character.only=TRUE) |&gt;
  suppressWarnings() |&gt; 
  suppressMessages() |&gt; 
  invisible()</td>
<td headers="reasoning" class="gt_row gt_left" style="font-family: 'Source Sans Pro'; font-weight: 400;">importing libraries required for preprocessing</td></tr>
    <tr><td headers="section" class="gt_row gt_left" style="font-family: 'Source Sans Pro'; font-weight: 400;">Importing Data</td>
<td headers="script_sample" class="gt_row gt_left" style="font-family: 'Fira Code'; font-weight: lighter; color: #FFFFFF; text-align: center; font-style: normal; white-space: pre-line; background-color: rgba(73,14,111,0.8);">read_csv(file = "./Data/Ask A Manager Salary Survey 2022_Responses.csv") |&gt; 
  clean_names() |&gt; 
  mutate(timestamp = mdy_hms(timestamp)) |&gt; 
  filter(!is.na(job_title)) |&gt; 
  mutate(additional_compensation = ifelse(is.na(additional_compensation),
                                          0,additional_compensation),
         full_compensation = salary+additional_compensation) |&gt; 
  filter(!currency %in% c("Other","HKD")) |&gt; 
  rownames_to_column("respondent")</td>
<td headers="reasoning" class="gt_row gt_left" style="font-family: 'Source Sans Pro'; font-weight: 400;">import data, convert date column to date type, remove unviable cases and create total compensation columns</td></tr>
    <tr><td headers="section" class="gt_row gt_left" style="font-family: 'Source Sans Pro'; font-weight: 400;">Open Text Cleaning</td>
<td headers="script_sample" class="gt_row gt_left" style="font-family: 'Fira Code'; font-weight: lighter; color: #FFFFFF; text-align: center; font-style: normal; white-space: pre-line; background-color: rgba(73,14,111,0.8);">text_cleaner &lt;- function(a_vec){
  tokens &lt;- str_split(a_vec,pattern="\s{1,}") |&gt; 
    unlist()
  tokens &lt;- tokens[!grepl("\s{1,}|[[:punct:]]|\d{1,}",tokens)] |&gt; str_to_lower()
  tokens &lt;- unique(tokens) 
  tokens &lt;- tokens[!tokens %in% c(stopwords::data_stopwords_nltk[["en"]])]
  return(tokens)}</td>
<td headers="reasoning" class="gt_row gt_left" style="font-family: 'Source Sans Pro'; font-weight: 400;">split open-text fields into tokens, remove punctuation, spaces and stopwords. The function returns a list of words per case</td></tr>
    <tr><td headers="section" class="gt_row gt_left" style="font-family: 'Source Sans Pro'; font-weight: 400;">List to Vec</td>
<td headers="script_sample" class="gt_row gt_left" style="font-family: 'Fira Code'; font-weight: lighter; color: #FFFFFF; text-align: center; font-style: normal; white-space: pre-line; background-color: rgba(73,14,111,0.8);">list_to_vec &lt;- function(a_vec){
  new_vec &lt;- a_vec |&gt; 
    as.character()
new_vec &lt;- gsub("(^c+[[:punct:]])|[[:punct:]]",
                replacement = "",
                new_vec)
  return(new_vec)}
</td>
<td headers="reasoning" class="gt_row gt_left" style="font-family: 'Source Sans Pro'; font-weight: 400;">Convert the list of words per case to a vector.</td></tr>
    <tr><td headers="section" class="gt_row gt_left" style="font-family: 'Source Sans Pro'; font-weight: 400;">Completeness Check</td>
<td headers="script_sample" class="gt_row gt_left" style="font-family: 'Fira Code'; font-weight: lighter; color: #FFFFFF; text-align: center; font-style: normal; white-space: pre-line; background-color: rgba(73,14,111,0.8);">completeness &lt;- function(a_vec){
  incomplete &lt;- round(100/length(a_vec)*a_vec[is.na(a_vec)] |&gt; length(),2)
return(incomplete)}
</td>
<td headers="reasoning" class="gt_row gt_left" style="font-family: 'Source Sans Pro'; font-weight: 400;">Check the level of missing values in each column.</td></tr>
  </tbody>
  
  
</table>
</div>
<p>A table containing 2022 Data Cleaner sections</p>
</div>
</div>
<p>The table above contains a few convenience functions used throughout the script. Importing of libraries is completed through <code>lapply</code> followed by <code>suppressWarnings</code>, <code>suppressMessages</code> and <code>invisible</code> functions. The last three functions calls are probably bad practise as warnings may be helpful down the line. A crucial function is the importing data followed by some basic cleaning functions from <code>lubridate</code> and <span class="citation" data-cites="wickham2022">Wickham (<a href="#ref-wickham2022" role="doc-biblioref">2022</a>)</span> . A more exotic function is <code>text_cleaner</code>, the main idea is to remove stopwords, punctuation and white spaces. Ultimately, the function returns a list of terms per case. This practise is not tidy <em>yet</em>. Another convenience function <code>list_to_vec</code>,an imitation of <a href="https://www.mrexcel.com/excel-tips/pivot-table-with-text-in-values-area">concatenating text values in pivot tables</a> in excel. Finally, the <code>completeness</code> function checks the percentage of missing values within a column. The function is intended to aid in checking the viability of a column in the dataset. Here, columns with missing value percentage &gt; 5% are excluded from the dataset.</p>
<p>These functions are applied through <code>purrr::map</code> a tidyverse equivalent to <code>base::lapply</code>, along with <code>dplyr::mutate</code> and <code>dplyr::across</code> to implement the functions consistently.</p>
<p>Another important task of the cleaning the data is the conversion of currencies to USD for non-USD salary values. This way, we can get closer to comparing apples with apples. The International Monetary Fund’s <a href="https://www.imf.org/external/np/fin/ert/GUI/Pages/CountryDataBase.aspx">Exchange Rate Report Wizard</a> which allows users to exchange rates for multiple time ranges. Importantly, the Hong Kong Dollar is not listed in the report. As such, salaries reported in that currency are not included in the analysis.</p>
<p>The final preprocessing step relies on the <code>tidymodels</code> and <span class="citation" data-cites="hvitfeldt2022">Hvitfeldt (<a href="#ref-hvitfeldt2022" role="doc-biblioref">2022</a>)</span> packages to specify a recipe to tokenize the values derived from <code>list_to_vec</code>,extract their TFIDF (Term Frequency-Inverse Document Frequency) of the tokens, log the salary values and remove near-zero variance variables.</p>
<p>Finally, the resulting data.frame is used in LASSO regression, which serves as our feature selection step.</p>
<div class="cell page-columns page-full">
<details>
<summary>see code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">source</span>(<span class="st">"./Scripts/2022_Data_Cleaner.R"</span>,</span>
<span id="cb2-2"><a href="#cb2-2"></a>       <span class="at">local =</span> knitr<span class="sc">::</span><span class="fu">knit_global</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p></p><figcaption class="figure-caption margin-caption">An image containing a Lasso Regression plot indicating coeffiecients</figcaption><p></p>
<p><img src="index_files/figure-html/Lasso Regression Plot-1.png" class="img-fluid figure-img" width="2100"></p>
</figure>
</div>
</div>
</div>
<p>Ultimately, we extract the variables of interest from the lasso model through the function below. The function is an improvement on the previous post, as it does rely on converting each matrix into a data.frame. In this instance, the function subsets the last model and minimum lambda value from the matrices which are in turn converted to a data.frame. The function is similar to Stata17’s <a href="https://www.stata.com/features/overview/lasso-model-selection-prediction/">lassocoef</a> or SPSS29’s Best option in <a href="https://www.ibm.com/docs/en/spss-statistics/29.0.0?topic=regression-linear-lasso-options">Linear Lasso Regression: Option</a>. The script outputs training and testing outputs for further analysis. In this way, the preprocessing section is isolated to a single script and negates the need to read-in data.</p>
<div class="cell">
<details>
<summary>see code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>variable_extractor <span class="ot">&lt;-</span> <span class="cf">function</span>(a_list){</span>
<span id="cb3-2"><a href="#cb3-2"></a>  min_lambda <span class="ot">&lt;-</span> a_list<span class="sc">$</span>lambda <span class="sc">|&gt;</span> <span class="fu">min</span>()</span>
<span id="cb3-3"><a href="#cb3-3"></a>  last_model <span class="ot">&lt;-</span> <span class="fu">length</span>(a_list<span class="sc">$</span>lambda)</span>
<span id="cb3-4"><a href="#cb3-4"></a>  lasso_variables <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">coef</span>(a_list))[,last_model] <span class="sc">|&gt;</span> </span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="fu">data.frame</span>()</span>
<span id="cb3-6"><a href="#cb3-6"></a>  lasso_variables<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">rownames</span>(lasso_variables)</span>
<span id="cb3-7"><a href="#cb3-7"></a>  <span class="fu">names</span>(lasso_variables) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"coef"</span>,<span class="st">"variable"</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a>  lasso_variables <span class="ot">&lt;-</span> lasso_variables[,<span class="fu">c</span>(<span class="st">"variable"</span>,<span class="st">"coef"</span>)]</span>
<span id="cb3-9"><a href="#cb3-9"></a>  lasso_variables <span class="ot">&lt;-</span> lasso_variables[<span class="sc">!</span><span class="fu">grepl</span>(<span class="at">pattern =</span> <span class="st">"[[:punct:]]Intercept[[:punct:]]"</span>,</span>
<span id="cb3-10"><a href="#cb3-10"></a>                                            lasso_variables<span class="sc">$</span>variable),]</span>
<span id="cb3-11"><a href="#cb3-11"></a><span class="fu">return</span>(lasso_variables)}</span>
<span id="cb3-12"><a href="#cb3-12"></a></span>
<span id="cb3-13"><a href="#cb3-13"></a>Salary_Modelling <span class="ot">&lt;-</span> <span class="fu">cbind</span>(Salary_Modelling[,<span class="fu">grep</span>(<span class="st">"full_comp_usd"</span>,<span class="fu">names</span>(Salary_Modelling))],</span>
<span id="cb3-14"><a href="#cb3-14"></a>Salary_Modelling[,<span class="fu">names</span>(Salary_Modelling) <span class="sc">%in%</span> <span class="fu">variable_extractor</span>(Lasso_Model)<span class="sc">$</span>variable])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data-modelling" class="level1 page-columns page-full" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> DATA MODELLING</h1>
<p>With our training and testing datasets in hand, we can explore some modelling options. Our outcome variable is <code>full_comp_usd</code>, a numeric variable, containing the log value of the reported USD compensation. Naturally, linear regression is a candidate model. It may also be useful to compare our linear regression model against some non-linear candidates, here we also fit a Multivariate Adaptive Regression Splines (MARS) and Keras regression models.</p>
<section id="ols-model-swiss-knife-approach" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="ols-model-swiss-knife-approach"><span class="header-section-number">2.1</span> OLS MODEL: SWISS KNIFE APPROACH</h2>
<div class="cell">
<details>
<summary>see code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>ols_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(full_comp_usd <span class="sc">~</span>.,<span class="at">data =</span> Training_Salary)</span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="fu">tbl_regression</span>(ols_model,</span>
<span id="cb4-5"><a href="#cb4-5"></a>               <span class="at">add_estimate_to_reference_rows =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-6"><a href="#cb4-6"></a>               <span class="at">exponentiate =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-7"><a href="#cb4-7"></a>  <span class="fu">add_glance_source_note</span>(<span class="at">label =</span> <span class="fu">list</span>(</span>
<span id="cb4-8"><a href="#cb4-8"></a>    r.squared <span class="sc">~</span> <span class="st">"R2"</span>,</span>
<span id="cb4-9"><a href="#cb4-9"></a>    adj.r.squared <span class="sc">~</span> <span class="st">"Adj R2"</span>,</span>
<span id="cb4-10"><a href="#cb4-10"></a>    p.value <span class="sc">~</span> <span class="st">"p-value"</span>,</span>
<span id="cb4-11"><a href="#cb4-11"></a>    statistic <span class="sc">~</span> <span class="st">"F-Statistic"</span>,</span>
<span id="cb4-12"><a href="#cb4-12"></a>    df <span class="sc">~</span> <span class="st">"Degrees of Freedom"</span>,</span>
<span id="cb4-13"><a href="#cb4-13"></a>    df.residual <span class="sc">~</span> <span class="st">"Residual df"</span>),</span>
<span id="cb4-14"><a href="#cb4-14"></a>    <span class="at">include =</span> <span class="fu">c</span>(r.squared,adj.r.squared,p.value,df,statistic,</span>
<span id="cb4-15"><a href="#cb4-15"></a>                df.residual)</span>
<span id="cb4-16"><a href="#cb4-16"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb4-17"><a href="#cb4-17"></a>  <span class="fu">italicize_labels</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="puugovyeqz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#puugovyeqz) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#puugovyeqz) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#puugovyeqz) .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

:where(#puugovyeqz) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#puugovyeqz) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#puugovyeqz) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#puugovyeqz) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#puugovyeqz) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#puugovyeqz) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#puugovyeqz) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#puugovyeqz) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#puugovyeqz) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#puugovyeqz) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#puugovyeqz) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#puugovyeqz) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#puugovyeqz) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#puugovyeqz) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#puugovyeqz) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#puugovyeqz) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#puugovyeqz) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#puugovyeqz) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#puugovyeqz) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#puugovyeqz) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#puugovyeqz) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#puugovyeqz) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#puugovyeqz) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#puugovyeqz) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#puugovyeqz) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#puugovyeqz) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#puugovyeqz) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#puugovyeqz) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#puugovyeqz) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#puugovyeqz) .gt_left {
  text-align: left;
}

:where(#puugovyeqz) .gt_center {
  text-align: center;
}

:where(#puugovyeqz) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#puugovyeqz) .gt_font_normal {
  font-weight: normal;
}

:where(#puugovyeqz) .gt_font_bold {
  font-weight: bold;
}

:where(#puugovyeqz) .gt_font_italic {
  font-style: italic;
}

:where(#puugovyeqz) .gt_super {
  font-size: 65%;
}

:where(#puugovyeqz) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#puugovyeqz) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#puugovyeqz) .gt_indent_1 {
  text-indent: 5px;
}

:where(#puugovyeqz) .gt_indent_2 {
  text-indent: 10px;
}

:where(#puugovyeqz) .gt_indent_3 {
  text-indent: 15px;
}

:where(#puugovyeqz) .gt_indent_4 {
  text-indent: 20px;
}

:where(#puugovyeqz) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="<strong>Characteristic</strong>"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>Beta</strong>"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>95% CI</strong><sup class=&quot;gt_footnote_marks&quot;>1</sup>"><strong>95% CI</strong><sup class="gt_footnote_marks">1</sup></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="<strong>p-value</strong>"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_administration</td>
<td headers="estimate" class="gt_row gt_center">0.17</td>
<td headers="ci" class="gt_row gt_center">-0.07, 0.42</td>
<td headers="p.value" class="gt_row gt_center">0.2</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_banking</td>
<td headers="estimate" class="gt_row gt_center">0.07</td>
<td headers="ci" class="gt_row gt_center">-0.32, 0.45</td>
<td headers="p.value" class="gt_row gt_center">0.7</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_care</td>
<td headers="estimate" class="gt_row gt_center">-0.20</td>
<td headers="ci" class="gt_row gt_center">-0.46, 0.07</td>
<td headers="p.value" class="gt_row gt_center">0.15</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_computing</td>
<td headers="estimate" class="gt_row gt_center">0.16</td>
<td headers="ci" class="gt_row gt_center">-0.20, 0.51</td>
<td headers="p.value" class="gt_row gt_center">0.4</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_education</td>
<td headers="estimate" class="gt_row gt_center">-0.12</td>
<td headers="ci" class="gt_row gt_center">-0.14, -0.10</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_engineering</td>
<td headers="estimate" class="gt_row gt_center">0.11</td>
<td headers="ci" class="gt_row gt_center">0.03, 0.19</td>
<td headers="p.value" class="gt_row gt_center">0.009</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_finance</td>
<td headers="estimate" class="gt_row gt_center">-0.01</td>
<td headers="ci" class="gt_row gt_center">-0.39, 0.37</td>
<td headers="p.value" class="gt_row gt_center">&gt;0.9</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_government</td>
<td headers="estimate" class="gt_row gt_center">0.13</td>
<td headers="ci" class="gt_row gt_center">-0.08, 0.33</td>
<td headers="p.value" class="gt_row gt_center">0.2</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_health</td>
<td headers="estimate" class="gt_row gt_center">0.19</td>
<td headers="ci" class="gt_row gt_center">-0.07, 0.46</td>
<td headers="p.value" class="gt_row gt_center">0.2</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_manufacturing</td>
<td headers="estimate" class="gt_row gt_center">-0.02</td>
<td headers="ci" class="gt_row gt_center">-0.09, 0.06</td>
<td headers="p.value" class="gt_row gt_center">0.7</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_nonprofits</td>
<td headers="estimate" class="gt_row gt_center">-0.09</td>
<td headers="ci" class="gt_row gt_center">-0.10, -0.07</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_public</td>
<td headers="estimate" class="gt_row gt_center">-0.33</td>
<td headers="ci" class="gt_row gt_center">-0.47, -0.19</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_employers_industry_tech</td>
<td headers="estimate" class="gt_row gt_center">0.12</td>
<td headers="ci" class="gt_row gt_center">-0.23, 0.48</td>
<td headers="p.value" class="gt_row gt_center">0.5</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_functional_area_of_job_advertising</td>
<td headers="estimate" class="gt_row gt_center">0.31</td>
<td headers="ci" class="gt_row gt_center">-0.49, 1.1</td>
<td headers="p.value" class="gt_row gt_center">0.4</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_functional_area_of_job_banking</td>
<td headers="estimate" class="gt_row gt_center">-0.43</td>
<td headers="ci" class="gt_row gt_center">-0.97, 0.11</td>
<td headers="p.value" class="gt_row gt_center">0.12</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_functional_area_of_job_computing</td>
<td headers="estimate" class="gt_row gt_center">0.71</td>
<td headers="ci" class="gt_row gt_center">-0.25, 1.7</td>
<td headers="p.value" class="gt_row gt_center">0.15</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_functional_area_of_job_education</td>
<td headers="estimate" class="gt_row gt_center">-0.03</td>
<td headers="ci" class="gt_row gt_center">-0.05, -0.01</td>
<td headers="p.value" class="gt_row gt_center">0.009</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_functional_area_of_job_finance</td>
<td headers="estimate" class="gt_row gt_center">0.39</td>
<td headers="ci" class="gt_row gt_center">-0.15, 0.93</td>
<td headers="p.value" class="gt_row gt_center">0.2</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_functional_area_of_job_pr</td>
<td headers="estimate" class="gt_row gt_center">-0.30</td>
<td headers="ci" class="gt_row gt_center">-1.1, 0.51</td>
<td headers="p.value" class="gt_row gt_center">0.5</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_functional_area_of_job_tech</td>
<td headers="estimate" class="gt_row gt_center">-0.52</td>
<td headers="ci" class="gt_row gt_center">-1.5, 0.44</td>
<td headers="p.value" class="gt_row gt_center">0.3</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_job_title_manager</td>
<td headers="estimate" class="gt_row gt_center">0.08</td>
<td headers="ci" class="gt_row gt_center">0.05, 0.11</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_job_title_senior</td>
<td headers="estimate" class="gt_row gt_center">0.23</td>
<td headers="ci" class="gt_row gt_center">0.19, 0.27</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_country_canada</td>
<td headers="estimate" class="gt_row gt_center">0.17</td>
<td headers="ci" class="gt_row gt_center">0.15, 0.19</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_country_states</td>
<td headers="estimate" class="gt_row gt_center">-0.50</td>
<td headers="ci" class="gt_row gt_center">-1.2, 0.19</td>
<td headers="p.value" class="gt_row gt_center">0.2</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_country_united</td>
<td headers="estimate" class="gt_row gt_center">1.2</td>
<td headers="ci" class="gt_row gt_center">0.56, 1.9</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
    <tr><td headers="label" class="gt_row gt_left" style="font-style: italic;">tfidf_race_white</td>
<td headers="estimate" class="gt_row gt_center">-0.09</td>
<td headers="ci" class="gt_row gt_center">-0.14, -0.04</td>
<td headers="p.value" class="gt_row gt_center">&lt;0.001</td></tr>
  </tbody>
  <tfoot class="gt_sourcenotes">
    <tr>
      <td class="gt_sourcenote" colspan="4">R2 = 0.155; Adj R2 = 0.153; p-value = &lt;0.001; Degrees of Freedom = 26; F-Statistic = 79.2; Residual df = 11,237</td>
    </tr>
  </tfoot>
  <tfoot class="gt_footnotes">
    <tr>
      <td class="gt_footnote" colspan="4"><sup class="gt_footnote_marks">1</sup> CI = Confidence Interval</td>
    </tr>
  </tfoot>
</table>
</div>
<p>OLS Regression Results illustrating an adjusted r-square of 0.15 on 11237 cases and global p value of &lt; 0.001</p>
</div>
</div>
<p>Fitting a linear regression model is rather straight forward. The model above yields an Adjusted R Square of 0.153. In other words, the model explains 15% of the variance in salaries. The beta, confidence interval and p-values of the variables considered are listed on the table. One way to report the aforementioned results would be to utilise the <code>report</code> package which can aid in reporting models in standard manner including beta values, standard error, confidence intervals etc. for the respective variables considered in the model.</p>
</section>
<section id="mars-model-splines-and-lines" class="level2 page-columns page-full" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="mars-model-splines-and-lines"><span class="header-section-number">2.2</span> MARS MODEL: SPLINES AND LINES</h2>
<p>Below, we build a MARS model and iterate through 10 cross-validation folds. The resulting models, does not out perform the OLS model. The R-Square average R-Square for the MARS model is 0.15.</p>
<div class="cell page-columns page-full">
<details>
<summary>see code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">library</span>(earth)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>MARS_Model <span class="ot">&lt;-</span> <span class="fu">earth</span>(full_comp_usd <span class="sc">~</span>.,Training_Salary,</span>
<span id="cb5-4"><a href="#cb5-4"></a>      <span class="at">degree =</span> <span class="dv">2</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>      <span class="at">glm =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"gaussian"</span>),</span>
<span id="cb5-6"><a href="#cb5-6"></a>      <span class="at">pmethod =</span> <span class="st">"exhaustive"</span>,</span>
<span id="cb5-7"><a href="#cb5-7"></a>      <span class="at">nfold =</span> <span class="dv">10</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>      <span class="at">ncross=</span> <span class="dv">10</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>      <span class="at">varmod.method =</span> <span class="st">"earth"</span>)</span>
<span id="cb5-10"><a href="#cb5-10"></a></span>
<span id="cb5-11"><a href="#cb5-11"></a>Fold_Rsquares <span class="ot">&lt;-</span> <span class="fu">lapply</span>(MARS_Model<span class="sc">$</span>cv.list,\(x){x[<span class="st">"rsq"</span>]})</span>
<span id="cb5-12"><a href="#cb5-12"></a></span>
<span id="cb5-13"><a href="#cb5-13"></a>Fold_Rsquares <span class="ot">&lt;-</span> <span class="fu">lapply</span>(Fold_Rsquares,data.frame)</span>
<span id="cb5-14"><a href="#cb5-14"></a></span>
<span id="cb5-15"><a href="#cb5-15"></a><span class="fu">theme_set</span>(ggthemes<span class="sc">::</span><span class="fu">theme_solarized_2</span>())</span>
<span id="cb5-16"><a href="#cb5-16"></a></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="fu">map2</span>(Fold_Rsquares,<span class="fu">names</span>(Fold_Rsquares),<span class="cf">function</span>(x,y){</span>
<span id="cb5-18"><a href="#cb5-18"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="fu">mutate</span>(<span class="at">fold_source =</span>y)</span>
<span id="cb5-20"><a href="#cb5-20"></a>})<span class="sc">%&gt;%</span></span>
<span id="cb5-21"><a href="#cb5-21"></a>  <span class="fu">do.call</span>(bind_rows,.) <span class="sc">|&gt;</span> </span>
<span id="cb5-22"><a href="#cb5-22"></a>  <span class="fu">mutate</span>(<span class="at">iteration =</span> <span class="fu">str_extract</span>(fold_source,<span class="st">"</span><span class="sc">\\</span><span class="st">d{1,2}$"</span>) <span class="sc">|&gt;</span> <span class="fu">as.integer</span>(),</span>
<span id="cb5-23"><a href="#cb5-23"></a>         <span class="at">fold_source =</span> <span class="fu">str_remove</span>(fold_source,<span class="st">"[[:punct:]]</span><span class="sc">\\</span><span class="st">d{1,}"</span>) <span class="sc">|&gt;</span> <span class="fu">as.factor</span>(),</span>
<span id="cb5-24"><a href="#cb5-24"></a>         <span class="at">fold_source =</span> <span class="fu">fct_reorder</span>(fold_source,iteration)) <span class="sc">|&gt;</span> </span>
<span id="cb5-25"><a href="#cb5-25"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(iteration,rsq,<span class="at">group=</span>fold_source))<span class="sc">+</span></span>
<span id="cb5-26"><a href="#cb5-26"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour =</span> fold_source),<span class="at">show.legend =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb5-27"><a href="#cb5-27"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"fold1"</span> <span class="ot">=</span> <span class="st">"#0F204B"</span>,</span>
<span id="cb5-28"><a href="#cb5-28"></a>                                 <span class="st">"fold2"</span><span class="ot">=</span> <span class="st">"#A71930"</span>,</span>
<span id="cb5-29"><a href="#cb5-29"></a>                                 <span class="st">"fold3"</span> <span class="ot">=</span> <span class="st">"#000000"</span>,</span>
<span id="cb5-30"><a href="#cb5-30"></a>                                 <span class="st">"fold4"</span> <span class="ot">=</span> <span class="st">"#9E83B7"</span>,</span>
<span id="cb5-31"><a href="#cb5-31"></a>                                 <span class="st">"fold5"</span><span class="ot">=</span><span class="st">"#00B140"</span>,</span>
<span id="cb5-32"><a href="#cb5-32"></a>                                 <span class="st">"fold6"</span> <span class="ot">=</span> <span class="st">"#BB133E"</span>,</span>
<span id="cb5-33"><a href="#cb5-33"></a>                                 <span class="st">"fold7"</span><span class="ot">=</span> <span class="st">"#490E6F"</span>,</span>
<span id="cb5-34"><a href="#cb5-34"></a>                                 <span class="st">"fold8"</span><span class="ot">=</span> <span class="st">"#0039A7"</span>,</span>
<span id="cb5-35"><a href="#cb5-35"></a>                                 <span class="st">"fold9"</span><span class="ot">=</span> <span class="st">"#00675A"</span>,</span>
<span id="cb5-36"><a href="#cb5-36"></a>                                 <span class="st">"fold10"</span><span class="ot">=</span> <span class="st">"#EA8400"</span>))<span class="sc">+</span></span>
<span id="cb5-37"><a href="#cb5-37"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>))<span class="sc">+</span></span>
<span id="cb5-38"><a href="#cb5-38"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>fold_source,</span>
<span id="cb5-39"><a href="#cb5-39"></a>             <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb5-40"><a href="#cb5-40"></a>             <span class="at">nrow=</span><span class="dv">5</span>, </span>
<span id="cb5-41"><a href="#cb5-41"></a>             <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p></p><figcaption class="figure-caption margin-caption">MARS Model Results indicating a selected model with an R-Square of 0.15</figcaption><p></p>
<p><img src="index_files/figure-html/MARS Model Results-1.png" class="img-fluid figure-img" width="2444"></p>
</figure>
</div>
</div>
</div>
<p>There are several ways to improve the model. Such as including factor variables in place of dummy variables, utilising polynomial regression in place of the gaussian family among others. For a more detailed account on how to work with enhance MARS models, see <span class="citation" data-cites="milborrow">Milborrow (<a href="#ref-milborrow" role="doc-biblioref">n.d.</a>)</span> .</p>
<div class="cell page-columns page-full">
<details>
<summary>see code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">plotmo</span>(MARS_Model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> plotmo grid:    tfidf_employers_industry_administration
                                                       0
 tfidf_employers_industry_banking tfidf_employers_industry_care
                                0                             0
 tfidf_employers_industry_computing tfidf_employers_industry_education
                                  0                                  0
 tfidf_employers_industry_engineering tfidf_employers_industry_finance
                                    0                                0
 tfidf_employers_industry_government tfidf_employers_industry_health
                                   0                               0
 tfidf_employers_industry_manufacturing tfidf_employers_industry_nonprofits
                                      0                                   0
 tfidf_employers_industry_public tfidf_employers_industry_tech
                               0                             0
 tfidf_functional_area_of_job_advertising tfidf_functional_area_of_job_banking
                                        0                                    0
 tfidf_functional_area_of_job_computing tfidf_functional_area_of_job_education
                                      0                                      0
 tfidf_functional_area_of_job_finance tfidf_functional_area_of_job_pr
                                    0                               0
 tfidf_functional_area_of_job_tech tfidf_job_title_manager
                                 0                       0
 tfidf_job_title_senior tfidf_country_canada tfidf_country_states
                      0                    0            0.3854429
 tfidf_country_united tfidf_race_white
            0.3849207        0.7425228</code></pre>
</div>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p></p><figcaption class="figure-caption margin-caption">MARS Model Results Visualisation containing variables and their relationships retrieved through the plotmo package.</figcaption><p></p>
<p><img src="index_files/figure-html/MARS Model Results Visualisation-1.png" class="img-fluid figure-img" width="2444"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="keras-gun-to-a-knife-fight" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="keras-gun-to-a-knife-fight"><span class="header-section-number">2.3</span> KERAS: GUN TO A KNIFE FIGHT</h2>
<p>We haven’t had a significant difference between the OLS model and MARS model. Below, we use build a <span class="citation" data-cites="allaire2022">Allaire and Chollet (<a href="#ref-allaire2022" role="doc-biblioref">2022</a>)</span> regression model. It is mostly likely a computationally inefficient approach but worth exploring nonetheless. Fortunately, with a few changes to <span class="citation" data-cites="chollet2022">Chollet, Kalinowski, and Allaire (<a href="#ref-chollet2022" role="doc-biblioref">2022</a>)</span> code , we can fit a regression model through Keras in R. Below, we change the data to matrix format suitable for the type of model we build. Thereafter, we fit it through 500 epochs and visualise the Mean Absolute Error and Loss (Mean Squared Error) of the model.</p>
<div class="cell">
<details>
<summary>see code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co">#|fig-cap: Specifying a Keras model for regression</span></span>
<span id="cb8-2"><a href="#cb8-2"></a><span class="fu">library</span>(keras)</span>
<span id="cb8-3"><a href="#cb8-3"></a>train_data <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(full_comp_usd <span class="sc">~</span>.,Training_Salary)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb8-4"><a href="#cb8-4"></a>train_targets <span class="ot">&lt;-</span> Training_Salary<span class="sc">$</span>full_comp_usd</span>
<span id="cb8-5"><a href="#cb8-5"></a>build_model <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb8-6"><a href="#cb8-6"></a>model <span class="ot">&lt;-</span> <span class="fu">keras_model_sequential</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7"></a><span class="fu">layer_dense</span>(<span class="dv">64</span>, <span class="at">activation =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="fu">layer_dense</span>(<span class="dv">64</span>, <span class="at">activation =</span> <span class="st">"relu"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="fu">layer_dense</span>(<span class="dv">1</span>)</span>
<span id="cb8-10"><a href="#cb8-10"></a>model <span class="sc">%&gt;%</span> <span class="fu">compile</span>(<span class="at">optimizer =</span> <span class="st">"rmsprop"</span>,</span>
<span id="cb8-11"><a href="#cb8-11"></a><span class="at">loss =</span> <span class="st">"mse"</span>,</span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="at">metrics =</span> <span class="st">"mae"</span>)</span>
<span id="cb8-13"><a href="#cb8-13"></a>model</span>
<span id="cb8-14"><a href="#cb8-14"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>see code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co">#|echo: true</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co">#|fig-cap: Fitting a regression Keras model </span></span>
<span id="cb9-3"><a href="#cb9-3"></a>k <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>fold_id <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>k, <span class="at">length.out =</span> <span class="fu">nrow</span>(train_data)))</span>
<span id="cb9-5"><a href="#cb9-5"></a>num_epochs <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>all_scores <span class="ot">&lt;-</span> <span class="fu">numeric</span>()</span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="fu">cat</span>(<span class="st">"Processing fold #"</span>, i, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb9-9"><a href="#cb9-9"></a>val_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(fold_id <span class="sc">==</span> i)</span>
<span id="cb9-10"><a href="#cb9-10"></a>val_data <span class="ot">&lt;-</span> train_data[val_indices, ]</span>
<span id="cb9-11"><a href="#cb9-11"></a>val_targets <span class="ot">&lt;-</span> train_targets[val_indices]</span>
<span id="cb9-12"><a href="#cb9-12"></a>partial_train_data <span class="ot">&lt;-</span> train_data[<span class="sc">-</span>val_indices, ]</span>
<span id="cb9-13"><a href="#cb9-13"></a>partial_train_targets <span class="ot">&lt;-</span> train_targets[<span class="sc">-</span>val_indices]</span>
<span id="cb9-14"><a href="#cb9-14"></a>model <span class="ot">&lt;-</span> <span class="fu">build_model</span>()</span>
<span id="cb9-15"><a href="#cb9-15"></a>model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(</span>
<span id="cb9-16"><a href="#cb9-16"></a>partial_train_data,</span>
<span id="cb9-17"><a href="#cb9-17"></a>partial_train_targets,</span>
<span id="cb9-18"><a href="#cb9-18"></a><span class="at">epochs =</span> num_epochs,</span>
<span id="cb9-19"><a href="#cb9-19"></a><span class="at">batch_size =</span> <span class="dv">16</span>,</span>
<span id="cb9-20"><a href="#cb9-20"></a><span class="at">verbose =</span> <span class="dv">1</span></span>
<span id="cb9-21"><a href="#cb9-21"></a>)</span>
<span id="cb9-22"><a href="#cb9-22"></a>results <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">evaluate</span>(val_data,</span>
<span id="cb9-23"><a href="#cb9-23"></a>val_targets, <span class="at">verbose =</span> <span class="dv">0</span>)</span>
<span id="cb9-24"><a href="#cb9-24"></a>all_scores[[i]] <span class="ot">&lt;-</span> results[[<span class="st">'mae'</span>]]</span>
<span id="cb9-25"><a href="#cb9-25"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Processing fold # 1 
Processing fold # 2 
Processing fold # 3 
Processing fold # 4 </code></pre>
</div>
</div>
<div class="cell">
<details>
<summary>see code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>num_epochs <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>all_mae_histories <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k) {</span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="fu">cat</span>(<span class="st">"Processing fold #"</span>, i, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a>val_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(fold_id <span class="sc">==</span> i)</span>
<span id="cb11-6"><a href="#cb11-6"></a>val_data <span class="ot">&lt;-</span> train_data[val_indices, ]</span>
<span id="cb11-7"><a href="#cb11-7"></a>val_targets <span class="ot">&lt;-</span> train_targets[val_indices]</span>
<span id="cb11-8"><a href="#cb11-8"></a>partial_train_data <span class="ot">&lt;-</span> train_data[<span class="sc">-</span>val_indices, ]</span>
<span id="cb11-9"><a href="#cb11-9"></a>partial_train_targets <span class="ot">&lt;-</span> train_targets[<span class="sc">-</span>val_indices]</span>
<span id="cb11-10"><a href="#cb11-10"></a>model <span class="ot">&lt;-</span> <span class="fu">build_model</span>()</span>
<span id="cb11-11"><a href="#cb11-11"></a>history <span class="ot">&lt;-</span> model <span class="sc">%&gt;%</span> <span class="fu">fit</span>(</span>
<span id="cb11-12"><a href="#cb11-12"></a>partial_train_data, partial_train_targets,</span>
<span id="cb11-13"><a href="#cb11-13"></a><span class="at">validation_data =</span> <span class="fu">list</span>(val_data, val_targets),</span>
<span id="cb11-14"><a href="#cb11-14"></a><span class="at">epochs =</span> num_epochs, <span class="at">batch_size =</span> <span class="dv">16</span>, <span class="at">verbose =</span> <span class="dv">1</span></span>
<span id="cb11-15"><a href="#cb11-15"></a>)</span>
<span id="cb11-16"><a href="#cb11-16"></a>mae_history <span class="ot">&lt;-</span> history<span class="sc">$</span>metrics<span class="sc">$</span>val_mae</span>
<span id="cb11-17"><a href="#cb11-17"></a>all_mae_histories[[i]] <span class="ot">&lt;-</span> mae_history</span>
<span id="cb11-18"><a href="#cb11-18"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Processing fold # 1 
Processing fold # 2 
Processing fold # 3 
Processing fold # 4 </code></pre>
</div>
<details>
<summary>see code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">plot</span>(history)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="index_files/figure-html/MAE and LOSS through the epochs-1.png" class="img-fluid" width="2100"></p>
</div>
</div>
<p>We know the three model’s performance metrics, the next question we need to answer is whether the data maintains the similar results on an out-of-sample dataset. Here we rely on <span class="citation" data-cites="kuhn2022">Kuhn and Wickham (<a href="#ref-kuhn2022" role="doc-biblioref">2022</a>)</span>, <code>yardstick</code> package to compare performance between the models. It is probably a better approach to use a tidymodel’s workflow and recipes as it provides all the functions needed for preprocessing and modelling.</p>
</section>
</section>
<section id="final-comparison" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> FINAL COMPARISON</h1>
<p>The results below illustrate the Mean Absolute Percentage Error, a measure of the percentage difference between predicted value and the actual value. Ideally, we want a low MAPE estimate; as it indicates better predictions. There are marginal difference in MAPE values across the three models.</p>
<div class="cell">
<details>
<summary>see code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>ols_prediction <span class="ot">&lt;-</span> <span class="fu">predict</span>(ols_model,Testing_Salary)</span>
<span id="cb14-2"><a href="#cb14-2"></a>ols_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">truth =</span> Testing_Salary<span class="sc">$</span>full_comp_usd,</span>
<span id="cb14-3"><a href="#cb14-3"></a>           <span class="at">estimate =</span> ols_prediction) <span class="sc">|&gt;</span> </span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"OLS Model"</span>)</span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a>mars_prediction <span class="ot">&lt;-</span> <span class="fu">predict</span>(MARS_Model,Testing_Salary)</span>
<span id="cb14-7"><a href="#cb14-7"></a>mars_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">truth =</span> Testing_Salary<span class="sc">$</span>full_comp_usd,</span>
<span id="cb14-8"><a href="#cb14-8"></a>                           <span class="at">estimate =</span> mars_prediction)</span>
<span id="cb14-9"><a href="#cb14-9"></a></span>
<span id="cb14-10"><a href="#cb14-10"></a>test_predictors <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(full_comp_usd <span class="sc">~</span>.,<span class="at">data =</span> Testing_Salary)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb14-11"><a href="#cb14-11"></a>test_outcome <span class="ot">&lt;-</span> Testing_Salary<span class="sc">$</span>full_comp_usd</span>
<span id="cb14-12"><a href="#cb14-12"></a></span>
<span id="cb14-13"><a href="#cb14-13"></a>result <span class="ot">&lt;-</span> <span class="fu">predict</span>(model,test_predictors)</span>
<span id="cb14-14"><a href="#cb14-14"></a></span>
<span id="cb14-15"><a href="#cb14-15"></a>keras_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">truth =</span> test_outcome,</span>
<span id="cb14-16"><a href="#cb14-16"></a>           <span class="at">estimate =</span> result) <span class="sc">|&gt;</span> </span>
<span id="cb14-17"><a href="#cb14-17"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"KERAS Model"</span>)</span>
<span id="cb14-18"><a href="#cb14-18"></a></span>
<span id="cb14-19"><a href="#cb14-19"></a></span>
<span id="cb14-20"><a href="#cb14-20"></a>MAPE_Data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">mape</span>(ols_results,</span>
<span id="cb14-21"><a href="#cb14-21"></a>               <span class="at">truth =</span> truth,</span>
<span id="cb14-22"><a href="#cb14-22"></a>               <span class="at">estimate =</span> estimate) <span class="sc">|&gt;</span> </span>
<span id="cb14-23"><a href="#cb14-23"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"OLS Model"</span>),</span>
<span id="cb14-24"><a href="#cb14-24"></a><span class="fu">mape</span>(mars_results,</span>
<span id="cb14-25"><a href="#cb14-25"></a>    <span class="at">truth =</span> truth,</span>
<span id="cb14-26"><a href="#cb14-26"></a>    <span class="at">estimate =</span> full_comp_usd) <span class="sc">|&gt;</span> </span>
<span id="cb14-27"><a href="#cb14-27"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"MARS Model"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb14-28"><a href="#cb14-28"></a>  <span class="fu">bind_rows</span>(<span class="fu">mape</span>(keras_results,</span>
<span id="cb14-29"><a href="#cb14-29"></a>    <span class="at">truth =</span> truth,</span>
<span id="cb14-30"><a href="#cb14-30"></a>    <span class="at">estimate =</span> estimate) <span class="sc">|&gt;</span> </span>
<span id="cb14-31"><a href="#cb14-31"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">"KERAS Model"</span>))</span>
<span id="cb14-32"><a href="#cb14-32"></a></span>
<span id="cb14-33"><a href="#cb14-33"></a><span class="fu">gt</span>(MAPE_Data <span class="sc">|&gt;</span> </span>
<span id="cb14-34"><a href="#cb14-34"></a>     <span class="fu">mutate</span>(<span class="at">.estimate =</span> <span class="fu">round</span>(.estimate,<span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<div id="byjmllxgse" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

:where(#byjmllxgse) .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

:where(#byjmllxgse) .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#byjmllxgse) .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

:where(#byjmllxgse) .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

:where(#byjmllxgse) .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

:where(#byjmllxgse) .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#byjmllxgse) .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

:where(#byjmllxgse) .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

:where(#byjmllxgse) .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

:where(#byjmllxgse) .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

:where(#byjmllxgse) .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

:where(#byjmllxgse) .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

:where(#byjmllxgse) .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

:where(#byjmllxgse) .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

:where(#byjmllxgse) .gt_from_md > :first-child {
  margin-top: 0;
}

:where(#byjmllxgse) .gt_from_md > :last-child {
  margin-bottom: 0;
}

:where(#byjmllxgse) .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

:where(#byjmllxgse) .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#byjmllxgse) .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

:where(#byjmllxgse) .gt_row_group_first td {
  border-top-width: 2px;
}

:where(#byjmllxgse) .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#byjmllxgse) .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

:where(#byjmllxgse) .gt_first_summary_row.thick {
  border-top-width: 2px;
}

:where(#byjmllxgse) .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#byjmllxgse) .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#byjmllxgse) .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

:where(#byjmllxgse) .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

:where(#byjmllxgse) .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

:where(#byjmllxgse) .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#byjmllxgse) .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#byjmllxgse) .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

:where(#byjmllxgse) .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

:where(#byjmllxgse) .gt_left {
  text-align: left;
}

:where(#byjmllxgse) .gt_center {
  text-align: center;
}

:where(#byjmllxgse) .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

:where(#byjmllxgse) .gt_font_normal {
  font-weight: normal;
}

:where(#byjmllxgse) .gt_font_bold {
  font-weight: bold;
}

:where(#byjmllxgse) .gt_font_italic {
  font-style: italic;
}

:where(#byjmllxgse) .gt_super {
  font-size: 65%;
}

:where(#byjmllxgse) .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

:where(#byjmllxgse) .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

:where(#byjmllxgse) .gt_indent_1 {
  text-indent: 5px;
}

:where(#byjmllxgse) .gt_indent_2 {
  text-indent: 10px;
}

:where(#byjmllxgse) .gt_indent_3 {
  text-indent: 15px;
}

:where(#byjmllxgse) .gt_indent_4 {
  text-indent: 20px;
}

:where(#byjmllxgse) .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=".metric">.metric</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id=".estimator">.estimator</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id=".estimate">.estimate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="model">model</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td headers=".metric" class="gt_row gt_left">mape</td>
<td headers=".estimator" class="gt_row gt_left">standard</td>
<td headers=".estimate" class="gt_row gt_right">3.708</td>
<td headers="model" class="gt_row gt_left">OLS Model</td></tr>
    <tr><td headers=".metric" class="gt_row gt_left">mape</td>
<td headers=".estimator" class="gt_row gt_left">standard</td>
<td headers=".estimate" class="gt_row gt_right">3.690</td>
<td headers="model" class="gt_row gt_left">MARS Model</td></tr>
    <tr><td headers=".metric" class="gt_row gt_left">mape</td>
<td headers=".estimator" class="gt_row gt_left">standard</td>
<td headers=".estimate" class="gt_row gt_right">3.844</td>
<td headers="model" class="gt_row gt_left">KERAS Model</td></tr>
  </tbody>
  
  
</table>
</div>
<p>A table containing MAPE results across the three models.</p>
</div>
</div>
<p>We are done squeezing water out of a rock. What can we conclude? There are better feature engineering approaches to explore. These include log-ratios in place of TFIDF, enhancing the dataset by attaching weights to industry, location and other aspects in the dataset. <a href="https://juliasilge.com/blog/uk-museums/">Julia Silge’s</a> recent blog post on high cardinality predictors may also be helpful in this regard. Alternatively, a classification model may serve as a better model to analyse the difference in pay from the dataset.</p>




</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">

</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-allaire2022" class="csl-entry" role="doc-biblioentry">
Allaire, J. J., and François Chollet. 2022. <em>Keras: R Interface to Keras</em>. <a href="https://keras.rstudio.com">https://keras.rstudio.com</a>.
</div>
<div id="ref-chollet2022" class="csl-entry" role="doc-biblioentry">
Chollet, François, Tomasz Kalinowski, and J. J. Allaire. 2022. <em>Deep Learning with r</em>. Second edition. Shelter Island, NY: Manning.
</div>
<div id="ref-hvitfeldt2022" class="csl-entry" role="doc-biblioentry">
Hvitfeldt, Emil. 2022. <em>Textrecipes: Extra Recipes for Text Processing</em>. <a href="https://CRAN.R-project.org/package=textrecipes">https://CRAN.R-project.org/package=textrecipes</a>.
</div>
<div id="ref-kuhn2022" class="csl-entry" role="doc-biblioentry">
Kuhn, Max, and Hadley Wickham. 2022. <em>Tidymodels: Easily Install and Load the Tidymodels Packages</em>. <a href="https://CRAN.R-project.org/package=tidymodels">https://CRAN.R-project.org/package=tidymodels</a>.
</div>
<div id="ref-milborrow" class="csl-entry" role="doc-biblioentry">
Milborrow, Stephen. n.d. <span>‘Notes on the Earth Package’</span>.
</div>
<div id="ref-wickham2022" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley. 2022. <em>Tidyverse: Easily Install and Load the Tidyverse</em>. <a href="https://CRAN.R-project.org/package=tidyverse">https://CRAN.R-project.org/package=tidyverse</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>